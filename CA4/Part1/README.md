# Chat Server Project with Docker

Este projeto tem como objetivo criar uma imagem Docker para um servidor de chat, construindo a aplicação dentro do Dockerfile.

This project aims to create a Docker image for a chat server, building the application inside the Dockerfile.

## Steps Completed

### Version 1: Build Inside Dockerfile

#### 1. Copy the Project

First, we copy the `gradle_basic_demo` project to the current working directory:

```sh
cp -r ~/DEVOPS-1110281/CA2/Part1/gradle_basic_demo ./
```

#### 2. Create the Dockerfile

Next, we create a Dockerfile with the following content:

```Dockerfile
# First stage: Build the application
FROM gradle:jdk17 as builder
LABEL author="Bernardo Amorim"

WORKDIR /ca4-part1

# Copy just the necessary files to build the application
COPY ./gradle_basic_demo /ca4-part1

# Execute the build
RUN ./gradlew clean build

# Second stage: Create the final image
FROM openjdk:17-jdk-slim

# Copy the jar file from the builder stage
COPY --from=builder /ca4-part1/build/libs/*.jar ca4-part1.jar

# Expose the port used by the chat server
EXPOSE 59001

# Specify the command to run the application
ENTRYPOINT ["java", "-cp", "ca4-part1.jar", "basic_demo.ChatServerApp", "59001"]
```

#### 3. Build the Docker Image

In the directory where the Dockerfile is located, we run the command to build the Docker image:

```sh
docker build -t chat-server:latest .
```

#### 4. Tag and Publish the Image on Docker Hub

After building the image, we tag and push the image to Docker Hub:

```sh
docker tag chat-server:latest BerAmorim/chat-server:latest
docker push BerAmorim/chat-server:latest
```

#### 5. Run the Docker Container

Finally, we run a container from the created image to ensure everything is working correctly:

```sh
docker run -p 59001:59001 chat-server:latest
```

### Version 2: Version 2: Build on Host and Copy JAR to Dockerfile

#### 1. Build the Project

First, we build the project on the host machine:

```sh
cd ~/DEVOPS-1110281/CA2/Part1/gradle_basic_demo
./gradlew clean build
```

#### 2. Create the Dockerfile

Next, we create a Dockerfile with the following content:

```Dockerfile
# Use a base image from the jdk
FROM openjdk:17-jdk-slim

# Specify the working directory
WORKDIR /ca4-part1

# Copy the jar file generated by the host machine to the container
COPY build/libs/*.jar ca4-part1.jar

# Expose the port used by the chat server
EXPOSE 59001

# Specify the command to run the application
ENTRYPOINT ["java", "-cp", "ca4-part1.jar", "basic_demo.ChatServerApp", "59001"]
```

#### 3. Build the Docker Image

In the directory where the Dockerfile is located, we run the command to build the Docker image:

```sh
docker build -t chat-server:copy .
```

#### 4. Tag and Publish the Image on Docker Hub

After building the image, we tag and push the image to Docker Hub:

```sh
docker tag chat-server:copy BerAmorim/chat-server:copy
docker push BerAmorim/chat-server:copy
```

#### 5. Run the Docker Container

Finally, we run a container from the created image to ensure everything is working correctly:

```sh
docker run -p 59001:59001 chat-server:copy
```

#### 6. Tag my Github Repository

```sh
cd ~/DEVOPS-1110281
git add .
git commit -m "Final changes for ca4-part1"
```

```sh
git tag ca4-part1
git push origin ca4-part1
```

#### 7. Execute the chat client in your host computer and connect to the chat server that is running in the container

```sh
docker run -p 59001:59001 chat-server:latest
```
or

```sh
docker run -p 59001:59001 chat-server:copy
```


```sh
cd ../CA4/Part1/gradle_basic_demo
 ./gradlew runClient -PserverIp=192.168.64.3 -PserverPort=59001
```


## Conclusion

With these steps, we have created Docker images for the chat server by building the application inside the Dockerfile and by building the application on the host and copying the JAR file to the Dockerfile, then publishing the images on Docker Hub.